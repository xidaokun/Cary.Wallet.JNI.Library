language: android
sudo: required
android:
  components:
  - build-tools-28.0.3
  - android-28
  - extra-android-m2repository
  - extra-android-support
licenses:
- android-sdk-preview-license-.+
- android-sdk-license-.+
- google-gdk-license-.+
before_install:
- openssl aes-256-cbc -K $encrypted_28b0ba5a8718_key -iv $encrypted_28b0ba5a8718_iv
  -in walletlibrary.jks.enc -out walletlibrary.jks -d
- echo "y" | sdkmanager "cmake;3.6.4111459"
- chmod +x gradlew
- "./gradlew dependencies || true"
script:
- "./gradlew assembleRelease"
before_script:
- wget https://dl.google.com/android/repository/android-ndk-r16b-linux-x86_64.zip
- unzip -qq android-ndk-r16b-linux-x86_64.zip
- export ANDROID_NDK_HOME=`pwd`/android-ndk-r16b
- export LOCAL_ANDROID_NDK_HOME="$ANDROID_NDK_HOME"
- export LOCAL_ANDROID_NDK_HOST_PLATFORM="linux-x86_64"
- export PATH=$PATH:${ANDROID_NDK_HOME}
- env
#before_deploy:
#  - mv app/build/outputs/apk/app-release.apk app/build/outputs/apk/walletlibrary.apk
deploy:
  provider: releases
  api_key:
    secure: fUok1JMDcKB/EVP+scoOIeGpkHSIXCbsi/oaDOqzt5xk7P2onA7o5GZp0ul0KGFbRoCZxEmve0mcdVJo5gmBb0UchKbWWbQILp8j/ytezpmzfaSRchioh1y/c12ulnPmSgILLvAU5a7tA8aDdExpty/fvYGNi6jSaZhecaTAkcdxTkvOj7qPH49YM9fjx8linSknw4/s6HXoV0LVKv9AeR/56Sm8I1ZVB3ZQRF8C7PZqVQl/bA5JO0SvylL+hTwLOMQ0VOdDPu6RzFZEtyv7sPBuqth0IsdUNvF9WkuZVplk6jfpZtfLLSDoashX36hyLML7g18KZm2eOqGgdsJFVHp1ZseU6RXBGN+OHuQTEnTcYpAOv3FvLRBf9oXT15gr0j7tIQH1I1LP9IkrUM4I4m9J5UsGuVWpIGGz2v2rBvZCPDAjAUCfro9k5hbHyS/EO0MHiutXm7lp4hyrShubp7Lf2buBsFIHbVJc2LOTKW0lgWqCv+MEh9saQrFYzuI6iRoPv5vTeiHzCFjeNXEFFtN+CyRedFcI2q9AuO0OgnkFKOzTRWelWbu3JXAYwOFhCDr0377yqpNTXoiG+xvYYlN0voW9A0KaiDxqZaAnrek+97l9FpOlGfp5ZsEai4CuExl5tviQd1lyuVVGh83SNWjy9l9CrUT1zEdNAkPHB10=
#  file: app/release/app-release.apk
#  file: app/build/outputs/apk/release/app-release.apk
  file: app/build/outputs/apk/app-release.apk
  skip_cleanup: true
  on:
    repo: xidaokun/Wallet.JNI.Library
    branch: master
#    tags: true
notifications:
  email:
  - xidaokun@elastos.org
  - 15921908346@163.com

before_cache:
- rm -f $HOME/.gradle/caches/modules-2/modules-2.lock

cache:
  directories:
  - "$HOME/.m2"
  - "$HOME/.gradle"
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"